(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global){global.powcss=require("./lib/powcss.js");global.powcss.lineify=require("./lib/lineify");global.powcss.compiler=require("./lib/compiler");global.powcss.context=require("./lib/context");global.powcss.util=require("./lib/util")}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./lib/compiler":2,"./lib/context":3,"./lib/lineify":4,"./lib/powcss.js":5,"./lib/util":6}],2:[function(require,module,exports){const IFX=/if[ ]+([_$a-zA-Z]+)[ ]*=/,util=require("./util");class Compiler{constructor(...extend){extend.forEach(ext=>{if(typeof ext==="function")this[ext.name]=ext;else if(Object.prototype.toString.call(ext)==="[object Object]"){for(let key in ext){this[key]=ext[key]}}});this.ctx=this.ctx||"ctx"}compile(n,i,ns){return this.decl(n)||this.if(n)||this.each(n)||this.let(n)||this.comment(n)||this.rule(n)}comment(n){if(n.mode!=="comment")return;return" "}rule(n){if(n.mode)return;let c=n.source.indexOf("${")===-1&&"'"||"`";return n.nodes&&n.nodes.length&&`${this.ctx}.open(${c}${n.source}${c});\n...${this.ctx}.close();`||`${this.ctx}.open(${c}${n.source}${c}).close();`}decl(n){if(n.mode!=="decl")return;let c=n.key.indexOf("${")===-1&&"'"||"`",v=n.val.endsWith(";")?n.val.substring(0,n.val.length-1):n.val,d=v.indexOf("${")===-1&&"'"||"`";return`${this.ctx}.decl(${c}${n.key}${c},${d}${v}${d});`}if(n){if(n.source.startsWith("if(")||n.source.startsWith("if ("))return n.source}each(n){if(n.source.startsWith(`${this.ctx}.each(`))return n.source;if(n.source.startsWith("each("))return this.ctx+"."+n.source}let(n){if(n.source.startsWith("let "))return n.source}}module.exports=function(...extend){return new Compiler(...extend)}},{"./util":6}],3:[function(require,module,exports){class Context{constructor(...extend){this.rule=null;this.rules=[];this.stack=[];extend.forEach(ext=>{if(typeof ext==="function")this[ext.name]=ext;else if(Object.prototype.toString.call(ext)==="[object Object]"){for(let key in ext){this[key]=ext[key]}}})}each(x,callback){if(Array.isArray(x)){x.forEach(callback)}else Object.keys(x).forEach(function(key){callback(x[key],key)});return this}open(name){if(this.rule){this.stack.push(this.rule);if(name.indexOf("&")!==-1)name=name.replace(/&/g,this.rule.name);if(!this.rule.decls){if(this.rule.name[0]==="@"){this.rule.decls=[];this.stack.push(this.rules);this.rules=this.rule.decls}else if(this.rule.name[0]!=="/"&&this.rule===this.rules[this.rules.length-1]){this.rules.pop()}}}this.rule={name:name};this.rules.push(this.rule);return this}close(){this.rule=this.stack.pop();if(Array.isArray(this.rule)){this.rules=this.rule;return this.close()}return this}name(){return this.rule&&this.rule.name||""}decl(key,val){if(val){if(!this.rule.decls)this.rule.decls={};this.rule.decls[key]=val;return val}return this.rule.decls[key]||""}toCSS(){let toCSS=(css,rule)=>{if(rule.decls){css+=rule.name+" {\n";if(Array.isArray(rule.decls)){css+=rule.decls.reduce(toCSS,"")}else for(let key in rule.decls){if(typeof rule.decls[key]==="string")css+=key+": "+rule.decls[key]+";\n";else throw new Error("decls must be a string or array: "+rule.name+"{"+key+"}")}css+="}\n"}else if(rule.name[0]==="/")css+=rule.name+"\n";else if(rule.name[0]==="@")css+=rule.name+";\n";else throw new Error("Unexpected bare rule: "+rule.name);return css};return this.rules.reduce(toCSS,"")}walk(context){let walk=function(rule){let self=this;if(rule.decls){self=self.open(rule.name);if(Array.isArray(rule.decls)){if(!rule.decls.every(walk,self))return false}else for(let key in rule.decls){if(typeof rule.decls[key]==="string"){if(!self.decl(key,rule.decls[key]))return false}else{throw new Error("decls must be a string or array: "+rule.name+"{"+key+"}")}}}else if(rule.name[0]==="/"||rule.name[0]==="@"){self=self.open(rule.name)}else{throw new Error("Unexpected bare rule: "+rule.name)}if(self)self=self.close();return!!self};return this.rules.every(walk,context)}}module.exports=function(...extend){return new Context(...extend)}},{}],4:[function(require,module,exports){class lineify{constructor(source){this.crlf=source.indexOf("\r\n")!=-1&&"\r\n"||source.indexOf("\r")!=-1&&"\r"||"\n";this.crlfLength=this.crlf.length;this.bol=0;this.eol=0;this.column=1;this.line=1;this.source=source;this.scan(null)}scan(){let tok={source:this.source.substring(this.bol,this.eol).trimRight(),offset:this.bol,line:this.line,column:this.column};if(this.eol===this.source.length){this.bol=this.eol;return tok.source&&tok||null}if(this.eol){this.bol=this.eol+this.crlfLength;this.line++;this.column=1}this.eol=this.source.indexOf(this.crlf,this.bol);if(this.eol===-1)this.eol=this.source.length;while(1){let c=this.source.charCodeAt(this.bol);if(c===32||c===9){this.bol++;this.column++;continue}if(this.eol!==this.bol)break;if(this.eol===this.source.length)break;this.line++;this.column=1;this.bol=this.eol+this.crlfLength;this.eol=this.source.indexOf(this.crlf,this.bol);if(this.eol===-1)this.eol=this.source.length}return tok}}module.exports=function(source){return new lineify(source)}},{}],5:[function(require,module,exports){const lineify=require("./lineify"),compiler=require("./compiler"),context=require("./context"),util=require("./util"),CONTINUATION="&\\,+-/*|=([";class PowCSS{constructor(plugins){this.plugins=plugins&&plugins.length&&plugins||[compiler()]}use(plugin){if(plugin)this.plugins.push(plugin);return this}process(source){this.result=source;if(!source)return this;this.result=this.parse(source);return this}parse(source){if(typeof source!=="string")return source;let root={offset:0,line:0,column:0,mode:"root",nodes:[]},parent=root,stack=[],i=0,tokens=[],lines=lineify(source),tok=lines.scan(),algin=tok&&tok.column||1;while(tok){tokens.push(tok);tok=lines.scan()}while(i<tokens.length){tok=tokens[i];while(tok.column<=parent.column){parent=stack.pop();algin=parent.nodes[parent.nodes.length-1].column}if(tok.source[0]==="}"){let last=parent.nodes[parent.nodes.length-1];if(!last.source.endsWith("{"))throw new Error(util.info(`Unpaired brackets from ${last.line}:${last.column}`,tok));last.source=last.source.slice(0,-1).trimRight();i++;continue}if(tok.column>algin){algin=tok.column;tok.nodes=tok.nodes||[];stack.push(parent);if(!parent.nodes.length)throw new Error(util.info("PowCSS broken",tok));parent=parent.nodes[parent.nodes.length-1];continue}i++;parent.nodes.push(tok);if(tok.source.startsWith("//")){tok.mode="comment";continue}if(tok.source.startsWith("/*")){if(tok.source.endsWith("*/"))tok.mode="comment";else while(i<tokens.length){tok.source+="\n"+tokens[i++].source;if(tok.source.endsWith("*/")){tok.mode="comment";break}}if(tok.mode!=="comment")throw new Error(util.info("Unclosed comments",tok));continue}let tail=tok.source.indexOf(" //");if(tail!==-1)tok.source=tok.source.substring(0,tail).trim();let pos=tok.source[0]==="@"&&-1||tok.source.indexOf(":")+1;tok.mode=pos>0&&(pos===tok.source.length||tok.source[pos]===" ")&&"decl"||"";tok.nodes=[];tail=CONTINUATION.indexOf(tok.source.charAt(tok.source.length-1));if(tail===1)tok.source=tok.source.slice(0,-1).trim();if(tail>0&&tok.mode===""||tail!==-1&&tok.mode==="decl")while(i<tokens.length){let t=tokens[i++];if(t.source.startsWith("//"))continue;if(t.source.startsWith("/*")){while(!t.source.endsWith("*/")&&i<tokens.length){t=tokens[i++]}continue}tail=t.source.indexOf(" //");tok.source+=tail===-1&&t.source||t.source.substring(0,tail).trimRight();tail=CONTINUATION.indexOf(tok.source.charAt(tok.source.length-1));if(tail===1)tok.source=tok.source.slice(0,-1).trim();if(tail===-1||tail===0&&tok.mode==="")break}if(tok.mode==="decl"){tok.key=tok.source.substring(0,pos-1).trimRight();tok.val=tok.source.substring(pos).trimLeft()}}return root}format(root){let fmt="",sp="\n";this.walk(root.nodes,null,(n,c,i,ns)=>{if(fmt)fmt+=sp;switch(n.mode){case"comment":fmt+=n.source.replace("\n",sp+" ");break;case"decl":fmt+=n.key+": "+n.val;break;default:fmt+=n.source;break}if(!i&&n.nodes&&n.nodes.length){sp+="  "}else if(i&&i+1===ns.length){sp=sp.slice(0,-2)}return true});return fmt}compile(){let root=this.result,plugins=this.plugins;if(!root||root.mode!="root")return"";let ctx={body:""};let compile=(item,ctx,index,nodes)=>{let body;plugins.some(plugin=>{if(typeof plugin.compile==="function"){body=plugin.compile(item,index,nodes);return body!=null}});if(!body||body===" ")return false;let pos=body.indexOf("...");if(pos!==-1){if(body.indexOf("...",pos+1)!==-1)throw new Error(util.info("Nested placeholders too much",item));if(!item.nodes||!item.nodes.length)throw new Error(util.info("Nested placeholders can not be used for empty nodes",item))}if(item.nodes&&item.nodes.length){let child={body:""};this.walk(item.nodes,child,compile);if(pos!==-1)body=body.substring(0,pos)+child.body+body.substring(pos+3);else body+="\n"+child.body}ctx.body+=body+"\n";return false};this.walk(root.nodes,ctx,compile);return ctx.body}build(params){params=params||"ctx";return Function(params,this.compile()+";return "+params.split(",")[0])}run(source,params,args){return this.process(source).build(params)(...args||[context()])}walk(nodes,context,callback){if(nodes&&typeof nodes.forEach==="function")nodes.forEach((item,index)=>{if(callback(item,context,index,nodes)&&item.nodes)this.walk(item.nodes,context,callback)},this);return this}}module.exports=function(plugins){return new PowCSS(plugins)}},{"./compiler":2,"./context":3,"./lineify":4,"./util":6}],6:[function(require,module,exports){const toString=Object.prototype.toString;let util={info:function(message,loc,at){return`${message} at: ${at||"<anonymous>"}:${loc.line}:${loc.column}`},isObject:function(x){return toString.call(x)==="[object Object]"},isNumber:function(x){return toString.call(x)==="[object Number]"},isArray:function(x){return Array.isArray(x)},isString:function(x){return typeof x==="string"},isFunction:function(x){return typeof x==="function"}};module.exports=util},{}]},{},[1]);